// Copyright 2016 FIX94
// This code is licensed to you under the terms of the GNU GPL, version 2;
// see file LICENSE or http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt

	.section .start,"ax"

	// Uninteresting stuff.
	.incbin "head.b"

0:	// get to corrupted LR
	.fill 0x44,4,0x3CF3CF3D

	// Our start address
	.long start

	// Needed to not get into crashes
	.fill 0x17B,4,0x3CF3CF3D

	// Align things properly -- there's code after this.
	.balign 4,0

start:
	// Disable interrupts
	mfmsr 3 ; rlwinm 3,3,0,17,15 ; mtmsr 3 ; isync

	// Set up a stack frame.
	lis 1,0x8170 ; li 0,0 ; stwu 0,-64(1)

	// Go for it!
	b _main
